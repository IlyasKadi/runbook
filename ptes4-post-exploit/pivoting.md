# pivoting

## Metasploit

- Route traffic through meterpreter sessions.
```shell
run autoroute -s 10.10.10.0/24
```

- Portforward to attacker machine.
```shell
portfwd add -l 1234 -p 80 -r $ip
```

- Ping sweep the internal network.

```shell
msf6 post(multi/gather/ping_sweep) > use ping_sweep
```

## Living off the land

- Ping sweep the internal network.

```shell
for i in {1..255}; do (ping -c 1 172.16.0.${i} | grep "bytes from" &); done
```

- The static nmap executable can be downloaded from [GitHub](https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap).
- The static ncat executable can be downloaded from [GitHub](https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/ncat).

- We can port forward using `socat` as follows

```shell
./socat tcp-l:9999,fork,reuseaddr tcp:forward-ip:80
```

## SSH tunnelling

- Start by dynamic port forwarding.

```shell
ssh -D 1234 user@$ip
```

- Next set up proxychains

```shell
sudo vim /etc/proxychains4.conf
# socks4 127.0.0.1 1234
```

- Portforward to attack machine.

```shell
ssh -L 1234:127.0.0.1:targetport user@$ip
```

## sshuttle

- Connect to the target using

```shell
sshuttle -r user@$ip 10.10.10.0/24
```

```shell
sshuttle -r user@$ip 10.10.10.0/24 --ssh-cmd "ssh -i id_rsa"
```
